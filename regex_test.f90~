program regex_test
  use regex
  implicit none
  type(c_ptr) :: preg
  integer(kind=c_size_t) :: nmatch
  type(regmatch_t), dimension(:), allocatable :: pmatch
  integer(kind=c_int) :: error_code
  integer(8) :: i
  integer(kind=c_size_t), parameter :: errbuf_size = 120_c_size_t
  character(len=errbuf_size) :: errbuf
  integer(kind=c_size_t) :: msg_size
  preg = alloc_regex_t()
  error_code = regcomp(preg, &
       "^[A-Z][^\\.?!]*[\\.?!]$", &
       0)
  nmatch = 10
  allocate(pmatch(nmatch))
  error_code = regexec(preg, &
       "This is an example of *correct* sentence.", &
       nmatch, pmatch, 0)
  msg_size = regerror(error_code, preg, errbuf, errbuf_size)
  print *, errbuf(1:msg_size - 1)
  do i = 1, nmatch
     print *, pmatch(i)%rm_so, pmatch(i)%rm_eo
  end do
  call regfree(preg)
  call c_free(preg)
end program regex_test
  
